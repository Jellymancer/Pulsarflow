//Pipeline defaults
params {

// Target to Followup
target_name = "NGC2808"
filterbank_file = "/hercules/results/jjawor/GC/NGC2808/data/NGC2808-01L-trapum_cfbf00000sub.fil"
beam_name = "cfbf00000"
period_start = "0.000"
period_end = "3.0"
//UTC Date Format: yyyy-mm-dd
utc_start = "2024-03-12"
utc_end = "2024-03-12"

// Singularity Images 
pulsarx_singularity_image = "/scratch/jjawor/containers/trapum_pulsarx_fold_docker_20220411.sif"
search_singularity_image = "/scratch/jjawor/containers/peasoup_master.sif"
sql_query_image = "/homes/vishnu/singularity_images/mmgps_sql_latest.sif"
utility_singularity_image = "/scratch/jjawor/containers/psrtools/" 

// Filtool Arguments (Stays the same for APSUSE and PTUSE)
telescope = "meerkat"
filtool_rfi_filter = "zdot"
filtool_threads = 1
filtool_channel_mask = "1323:1384" 
//Do you want to use filtool to clean your observations for APSUSE observations? 1=yes, 0=no 
use_filtool = 1


// DM split arguments
dm_create_script = "${baseDir}/create_DM_subdivisions.py"
dm_start = 0
dm_end = 400
dm_step = 0.1
no_dm_splits = 16
dm_decimals = 1
output_dm_dir = "${baseDir}/DM_RANGES"

phase_predictor = "${baseDir}/create_phase_predictor_dspsr_peasoup_period_range_cands.py"

// Peasoup Arguments. Stays the same for APSUSE and PTUSE observations. Code figures out the right power of two size for FFT.
min_snr = "8.0"
acc_start = "-4.0"
acc_end = "4.0"
ram_limit_gb = "50.0"
nh = "3"
ngpus = "1"
total_cands_limit = "2000"
dm_file = "${baseDir}/dm_range_peasoup.txt"
kill_file = "${baseDir}/killfile.txt"


// pulsarx folding
fold_script = "${baseDir}/fold_peasoup_pulsarx.py"
pulsarx_fold_template = "${baseDir}/meerkat_fold.template"
psrfold_fil_threads = 40
no_cands_to_fold = 100
psrfold_fil_channel_mask = ""
}


process {

    withName: generateDMFiles {
        publishDir = [
            path: "DM_RANGES/",
            pattern: "**/*.txt",
            mode: 'copy',
            
        ]
    }

    withName: fold_peasoup_cands_pulsarx {

        publishDir = [
            path: { input_file.parent },
            pattern: "*.{ar,png,xml,candfile,cands}",
            mode: 'copy',
        ]
    }

    withName: filtool {
      publishDir = [
            path: "CLEAN/${params.target_name}/",
            pattern: "*.fil",
            mode: 'symlink',
        ]
    }


    // If one observation fails, it will only stop downstream processes, but not the other independent proccess
    errorStrategy = 'ignore'   

}


profiles {

   local {
    includeConfig 'local.config' 
 }

   condor {
    includeConfig 'condor.config'
   }

   slurm {
    includeConfig 'slurm.config'
   }
}
