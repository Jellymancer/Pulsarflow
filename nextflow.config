//Pipeline defaults
params {

// Target to Followup
target_name = "NGC2808"
filterbank_list = "${baseDir}/targets.txt"
beam_name = "cfbf00000"
period_start = "0.000"
period_end = "3.0"
//UTC Date Format: yyyy-mm-dd
utc_start = "2024-03-12"
utc_end = "2024-03-12"

// Singularity Images 
pulsarx_singularity_image = "/scratch/jjawor/containers/psrx_new/"
search_singularity_image = "/scratch/jjawor/containers/peasoup_master.sif"
utility_singularity_image = "/scratch/jjawor/containers/psrtools/" 
bc_image = "/scratch/jjawor/containers/test"
old_pulsarx_singularity_image = "/hercules/scratch/jjawor/containers/trapum_pulsarx_fold_docker_20220411.sif"
presto5_singularity_image = "/scratch/jjawor/containers/presto5/"

// Filtool Arguments
telescope = "meerkat"
filtool_rfi_filter = ""
filtool_threads = 1
filtool_channel_mask = "" 
//Do you want to use filtool to clean your observations? 1=yes, 0=no 
use_filtool = 1

//Filterbank split
split_script = "${baseDir}/scripts/split_filterbank.py"
split_filterbank = 0
split_blocks = 2

// DM split arguments
dm_create_script = "${baseDir}/scripts/create_DM_subdivisions.py"
dm_start = 100
dm_end = 120
dm_step = 0.1
no_dm_splits = 1
dm_decimals = 2
dm_out_dir = "${baseDir}/out/DM_RANGES"
phase_predictor = "${baseDir}/scripts/create_phase_predictor_dspsr_peasoup_period_range_cands.py"

// Peasoup Arguments. Stays the same for APSUSE and PTUSE observations. Code figures out the right power of two size for FFT.
min_snr = "7.0"
acc_start = "-15.0"
acc_end = "15.0"
ram_limit_gb = "70.0"
nh = "5"
ngpus = "1"
total_cands_limit = "300"
kill_file = "${baseDir}/killfile.txt"


// Aggregation script
aggregate_script = "${baseDir}/scripts/read_xmls.py"

// Sifting
sift_script = "${baseDir}/sifting/sift_pointing.py"

// pulsarx folding
fold_script = "${baseDir}/scripts/fold_peasoup_pulsarx.py"
pulsarx_fold_template = "${baseDir}/meerkat_fold.template"
psrfold_fil_threads = 44
no_cands_to_fold = 300
psrfold_fil_channel_mask = ""
psrfold_fil_nh = 1
min_snr_fold = 6.0

// classification
classify_script = "${baseDir}/SLURM_PULSARMINER/pics_classifier_multiple_models.py"
model_dir = "${baseDir}/ml_models"
classify_min_fold_snr = null


// Prepare for candyjar 
prepare_for_candyjar_script = "${baseDir}/scripts/prepare_cands_for_candyjar_pulsarx.py"
metafile = "${baseDir}/2020-11-05T10:13:34.meta"

}

process {

    withName: generateDMFiles {
        publishDir = [
            path: "${params.dm_out_dir}",
            pattern: "*.txt",
            mode: 'copy',
        ]
    }

    // If one observation fails, it will only stop downstream processes, but not the other independent proccess
    errorStrategy = 'ignore'   

}


profiles {

   local {
    includeConfig 'local.config' 
 }

   condor {
    includeConfig 'condor.config'
   }

   slurm {
    includeConfig 'slurm.config'
   }
}
